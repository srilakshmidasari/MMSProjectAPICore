<app-page-header title="PMOrder" icon="assignment_ind"></app-page-header>
<div class="page-content" >
    
    <div class="example-container mat-elevation-z8 mt-2 table-responsive prng-table">
        <mat-progress-bar *ngIf="loadingIndicator" mode="query"></mat-progress-bar>
        <div>
            <p-table #dt [value]="pmOrdersList" [paginator]="true" expandableRows="true" [rows]="10" sortField="reference1"
                matSortDirection="desc" [tableStyle]="{'table-layout':'auto'}" [rowsPerPageOptions]="[10,20,50]"
                sortMode="single" rowExpandMode="single" dataKey="id"
                [globalFilterFields]="['id','reference1','startDate','endDate','assetName','locationName', 'updatedDate','issue','resolution']">
                <ng-template pTemplate="caption">
                    <div style="text-align: right">

                        <input type="text" pInputText size="50"
                            placeholder="{{'PMOrder.Management.SearchbyPMOrder'| translate}}"
                            (input)="dt.filterGlobal($event.target.value, 'contains')" style="width:auto">
                    </div>
                </ng-template>
                <ng-template pTemplate="header">
                    <tr>
                        <th style="width: 3em"></th>
                        <th [pSortableColumn]="'id'">{{'PMOrder.Management.PMOrderId'| translate}}
                            <p-sortIcon [field]="'id'"></p-sortIcon>
                        </th>
                        <th [pSortableColumn]="'reference1'">{{'PMOrder.Management.Reference'| translate}}
                            <p-sortIcon [field]="'reference1'"></p-sortIcon>
                        </th>
                        <th [pSortableColumn]="'startDate'">{{'PMOrder.Management.StartDate'| translate}}
                            <p-sortIcon [field]="'startDate'"></p-sortIcon>
                        </th>
                        <th [pSortableColumn]="'endDate'">{{'PMOrder.Management.EndDate'| translate}}
                            <p-sortIcon [field]="'endDate'"></p-sortIcon>
                        </th>
                        <th [pSortableColumn]="'assetName'">{{'PMOrder.Management.AssetName'| translate}}
                            <p-sortIcon [field]="'assetName'"></p-sortIcon>
                        </th>
                        <!-- <th [pSortableColumn]="'locationName'">{{'PMOrder.Management.LocationName'| translate}}
                            <p-sortIcon [field]="'locationName'"></p-sortIcon>
                        </th> -->
                        <th [pSortableColumn]="'statusTypeName'">{{'PMOrder.Management.StatusName'| translate}}
                            <p-sortIcon [field]="'statusTypeName'"></p-sortIcon>
                        </th>
                        <!-- <th [pSortableColumn]="'updatedDate'">{{'Work Order.Management.Updated Date'| translate}}
                            <p-sortIcon [field]="'updatedDate'"></p-sortIcon>
                        </th> -->
                        <th [pSortableColumn]="'issue'">{{'PMOrder.Management.Issue'| translate}}
                            <p-sortIcon [field]="'issue'"></p-sortIcon>
                        </th>
                        <th [pSortableColumn]="'resolution'">{{'PMOrder.Management.Resolution'| translate}}
                            <p-sortIcon [field]="'resolution'"></p-sortIcon>
                        </th>
                        <!-- <th [pSortableColumn]="'storeName'">Store Name
                            <p-sortIcon [field]="'storeName'"></p-sortIcon>
                        </th>
                        <th [pSortableColumn]="'workTypeName'">Work Type
                            <p-sortIcon [field]="'workTypeName'"></p-sortIcon>
                        </th>
                        <th [pSortableColumn]="'workStatusName'">Work Status
                            <p-sortIcon [field]="'workStatusName'"></p-sortIcon>
                        </th>
                        <th [pSortableColumn]="'workTechnicianName'">Work Teach
                            <p-sortIcon [field]="'workTechnicianName'"></p-sortIcon>
                        </th>
                        <th [pSortableColumn]="'workFaultName'">Work Fault
                            <p-sortIcon [field]="'workFaultName'"></p-sortIcon>
                        </th> -->
                        <!-- <th>{{'Purchase Order.Management.Is Active'|translate}}
                        </th> -->
                        <th class="just-cont-center">{{'PMOrder.Management.Actions'| translate}}
                            <!-- <button mat-button color="primary"
                                matTooltip="{{'Work Order.Management.Add Order'| translate}}" (click)="addClick()">
                                <mat-icon class="mat-button-icon">add</mat-icon>
                                {{'Work Order.Management.Add Order'|translate}}
                            </button> -->
                        </th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-req let-rowIndex="rowIndex" let-expanded="expanded">
                    <tr>
                        <td style="width: 3em">
                            <a [pRowToggler]="req"
                                (click)="getItemsByworkOrderId(req, expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right')">
                                <i [ngClass]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"></i>
                            </a>
                        </td>
                        <td>{{req.id}}</td>
                        <td>{{req.reference1}}</td>
                        <td>{{req.startDate | date: 'dd/MM/yyyy '}}</td>
                        <td>{{req.endDate  | date: 'dd/MM/yyyy '}}</td>
                        <td>{{req.assetName}}</td>
                        <!-- <td>{{req.locationName}}</td> -->
                        <td>{{req.statusTypeName}}</td>
                        <!-- <td>{{req.updatedDate | date: 'dd/MM/yyyy '}}</td> -->
                        <td>{{req.issue}}</td>
                        <td>{{req.resolution}}</td>
                        <!-- <td>{{req.storeName}}</td>
                        <td>{{req.workTypeName}}</td>
                        <td>{{req.workStatusName}}</td>
                        <td>{{req.workTechnicianName}}</td>
                        <td>{{req.workFaultName}}</td>  -->
                        <!-- <td align="center">
                            <mat-checkbox [(ngModel)]="req.isActive" disabled="true"> </mat-checkbox>
                        </td> -->
                        <td>
                            <!-- <button class="just-cont-center" mat-icon-button *ngIf="req.statusTypeName != 'Approved' && req.statusTypeName != 'Closed'"
                                matTooltip="{{'Work Order.Management.Edit'|translate}}"  (click)="onEditClick(req)">
                                <mat-icon color="primary">edit</mat-icon>
                            </button>
                            <button class="just-cont-center" mat-icon-button *ngIf="req.statusTypeName != 'Closed'"
                                matTooltip="{{'Work Order.Management.Delete'|translate}}" [hidden]="!req.isActive"
                                (click)="confirmDelete(req)">
                                <mat-icon color="warn">delete</mat-icon>
                            </button>
                            <button class="just-cont-center" mat-icon-button
                                matTooltip="{{'Work Order.Management.View WorkOrder'|translate}}"
                                (click)="onViewClick(req)">
                                <mat-icon color="accent">visibility icon</mat-icon>
                            </button>
                            <button class="z-index" mat-icon-button matTooltip="{{'Work Order.Management.Accept'|translate}}" *ngIf="req.statusTypeName == 'Open'" (click)="acceptClick(req)">
                                <mat-icon color="primary">thumb_up</mat-icon>
                            </button>
                            <button class="z-index" mat-icon-button matTooltip="{{'Work Order.Management.Reject'|translate}}"  *ngIf="req.statusTypeName == 'Open'" (click)="rejectClick(req)">
                                <mat-icon color="warn">thumb_down</mat-icon>
                            </button> -->
                            <button class="z-index" mat-icon-button matTooltip="{{'Work Order.Management.Close'|translate}}" 
                                >
                                <mat-icon color="warn">cancel</mat-icon>
                            </button>
                        </td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="rowexpansion" let-rowData let-columns="columns">
                    <tr>
                        <td [attr.colspan]="10">
                            <p-table #dt1 [responsive]="true" [value]="PMOrderItemList" [rows]="5"
                                sortField="itemName" [paginator]="true" [rowsPerPageOptions]="[5,10,15]">
                                <ng-template pTemplate="header">
                    <tr>
                        <th class="product-id" [pSortableColumn]="'itemName'">
                            {{'Work Order.Management.Item Name'|translate}}
                            <p-sortIcon [field]="'itemName'"></p-sortIcon>
                        </th>
                        <th class="product-id" [pSortableColumn]="'itemReference'">
                            {{'Work Order.Management.Item Reference'|translate}}
                            <p-sortIcon [field]="'itemReference'"></p-sortIcon>
                        </th>
                        <th class="product-id" [pSortableColumn]="'quantity'">
                            {{'Work Order.Management.Quantity'|translate}}
                            <p-sortIcon [field]="'quantity'"></p-sortIcon>
                        </th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-expanded="expanded" let-rowdata>
                    <tr>
                        <td>{{rowdata.itemName}}</td>
                        <td>{{rowdata.itemReference}}</td>
                        <td>{{rowdata.quantity}}</td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage" let-columns>
                    <tr *ngIf="PMOrderItemList.length == 0">
                        <td colspan="3" class="ui-datatable-emptymessage text-center">
                            {{'Work Order.Management.No Records Found'|translate}}
                        </td>
                    </tr>
                </ng-template>
            </p-table>
            </td>
            </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage" let-columns>
                <tr>
                    <td colspan="10" class="ui-datatable-emptymessage text-center">
                        {{'Work Order.Management.No Records Found'|translate}}
                    </td>
                </tr>
            </ng-template>
            </p-table>
        </div>
    </div>
</div>
